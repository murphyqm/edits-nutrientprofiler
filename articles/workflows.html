<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nutrientprofiler">
<title>Example HPC workflow and troubleshooting • nutrientprofiler</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example HPC workflow and troubleshooting">
<meta property="og:description" content="nutrientprofiler">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nutrientprofiler</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/nutrientprofiler.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/nutrientprofile_assessment.html">Nutrient Profile Model Assessment</a>
    <a class="dropdown-item" href="../articles/nutrientprofile_scoring.html">Nutrient Profile Model Scoring</a>
    <a class="dropdown-item" href="../articles/specific_gravity.html">Specific Gravity Adjustment</a>
    <a class="dropdown-item" href="../articles/workflows.html">Example HPC workflow and troubleshooting</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Leeds-CDRC/nutrientprofiler/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example HPC workflow and troubleshooting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Leeds-CDRC/nutrientprofiler/blob/HEAD/vignettes/workflows.Rmd" class="external-link"><code>vignettes/workflows.Rmd</code></a></small>
      <div class="d-none name"><code>workflows.Rmd</code></div>
    </div>

    
    
<p>This vignette walks you through a variety of different installation
options and workflows for analysing data in bulk on a high performance
computing (HPC) platform.</p>
<div class="section level2">
<h2 id="loading-package-onto-an-airgapped-hpc-system">Loading package onto an “airgapped” HPC system<a class="anchor" aria-label="anchor" href="#loading-package-onto-an-airgapped-hpc-system"></a>
</h2>
<p>If working on a secure or “airgapped” system without internet access,
using the R <code>remotes</code> package to install
<code>nutrientprofiler</code> will not work.</p>
<p>Instead, if there is a file/data transfer process available, the
zipped package can be transferred to the secure computational platform
and installed locally.</p>
<p>This process can be broken down into 3 steps:</p>
<ol style="list-style-type: decimal">
<li>Downloading the package/zipped archive to your local system</li>
<li>Transferring the files to the secure system (after any required
security checks)</li>
<li>Installing without internet access on the secure system.</li>
</ol>
<p>The instructions here assume access to some form of archived CRAN
mirror so that other commonly used packages are available. Please check
through the packages listed in the code snippets and ensure you have
access to these on your system.</p>
<div class="section level3">
<h3 id="downloading-the-package-to-your-local-machine">1. Downloading the package to your local machine<a class="anchor" aria-label="anchor" href="#downloading-the-package-to-your-local-machine"></a>
</h3>
<p>You can download a specific tagged release (see the <a href="https://github.com/Leeds-CDRC/nutrientprofiler/releases" class="external-link">GitHub
releases</a> page) or a development pre-release version of the code from
a specific branch of the repository.</p>
<p>Tagged releases allow for better reproducibility; however, if a
pre-release version needs to be used, reproducibility can still be
ensured by recording the download link used and the access date.</p>
<div class="section level4">
<h4 id="downloading-a-tagged-release">1.1 Downloading a tagged release<a class="anchor" aria-label="anchor" href="#downloading-a-tagged-release"></a>
</h4>
<p><strong>The recommended method is to download the most recent tagged
release as a <code>.tar.gz</code> archive.</strong></p>
<p>From your local desktop you can run the following R snippet to
download the <code>v1.0.0</code> release of the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download the v1.0.0 release as a .tar.gz archive</span></span>
<span><span class="co"># to your current directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://github.com/Leeds-CDRC/nutrientprofiler/archive/refs/tags/v1.0.0.tar.gz"</span>,</span>
<span>              dest <span class="op">=</span> <span class="st">"./nutrientprofiler-v1.0.0.tar.gz"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, this can be downloaded directly from the <a href="https://github.com/Leeds-CDRC/nutrientprofiler/releases" class="external-link">GitHub
releases</a> page.</p>
<p>A different release can be specified by changing the release tag.
Make sure to also update the destination filename to prevent
confusion:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># replace &lt;tag&gt; with the required version number</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://github.com/Leeds-CDRC/nutrientprofiler/archive/refs/tags/&lt;tag&gt;.tar.gz"</span>,</span>
<span>              dest <span class="op">=</span> <span class="st">"./nutrientprofiler-&lt;tag&gt;.tar.gz"</span><span class="op">)</span></span></code></pre></div>
<p>If required, zip file archives are also available on the <a href="https://github.com/Leeds-CDRC/nutrientprofiler/releases" class="external-link">GitHub
releases</a> page or can be downloaded using the following R script
below. Please note that these <code>.zip</code> archives require a
slightly different installation to <code>.tar.gz</code>; please read
through the isntallation steps first.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download the &lt;tag&gt; release as a zip archive</span></span>
<span><span class="co"># to your current directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://github.com/Leeds-CDRC/nutrientprofiler/archive/refs/tags/&lt;tag&gt;.zip"</span>,</span>
<span>              dest <span class="op">=</span> <span class="st">"./nutrientprofiler-&lt;tag&gt;.zip"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="downloading-the-current-development-version-or-a-specific-branch">1.2 Downloading the current development version or a specific
branch<a class="anchor" aria-label="anchor" href="#downloading-the-current-development-version-or-a-specific-branch"></a>
</h4>
<p>If you want to install a pre-release version of a specific version on
a branch, replace <code>tags/version-number</code> in the url with
<code>heads/branch-name</code> (and rename the destination file
something sensible).</p>
<p><strong>Please record the date of download and most recent commit
identifier as the branch may be updated or changed following your
download and installation.</strong></p>
<p>For example, the following downloads the current package on the
“VarEdits” branch of the repository:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># replace "tags/version-number" with "heads/branch-name":</span></span>
<span><span class="co"># in this example, we replaced "tags/v1.0.0" with "heads/VarEdits"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://github.com/Leeds-CDRC/nutrientprofiler/archive/refs/heads/VarEdits.tar.gz"</span>,</span>
<span>              dest <span class="op">=</span> <span class="st">"./nutrientprofiler-VarEdits.tar.gz"</span><span class="op">)</span></span></code></pre></div>
<p>Again, a zip file version can be downloaded by replacing
<code>tar.gz</code> in the snippet above with <code>zip</code>. A zip
file can also be downloaded from the project <a href="https://github.com/Leeds-CDRC/nutrientprofiler" class="external-link">GitHub page</a> by
navigating to the required branch and then using the green “Code” button
to open the “Clone” option menu, and selecting the “Download zip”
option.</p>
<p>For added reproducibility, you can specify the git commit tag to
ensure you are using a specific version:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use the unique commit id after "archive/" to specify a specific commit on a branch</span></span>
<span><span class="co"># use the first 8 characters of the commit id to tag your downloaded archive</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://github.com/Leeds-CDRC/nutrientprofiler/archive/8502784c9e1402505530d87db001fc23fb0fb6df.tar.gz"</span>,</span>
<span>              dest <span class="op">=</span> <span class="st">"./nutrientprofiler-8502784.tar.gz"</span><span class="op">)</span></span></code></pre></div>
<p>Again, make sure to modify the installation command to match the
archive name you’ve supplied.</p>
</div>
</div>
<div class="section level3">
<h3 id="transferring-your-code-to-the-secure-platform">2. Transferring your code to the secure platform<a class="anchor" aria-label="anchor" href="#transferring-your-code-to-the-secure-platform"></a>
</h3>
<p>This step will vary depending on the data transfer policies and
process enforced by your institution. While the package archive can be
unzipped for testing, it should be saved on the secure system in it’s
original compressed format.</p>
</div>
<div class="section level3">
<h3 id="installation">3. Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>On the secure computing platform, once the archive has been
transferred, you can then install the package. The installation method
differs depending on the filetype.</p>
<div class="section level4">
<h4 id="install--tar-gz-archives">3.1 Install <code>.tar.gz</code> archives<a class="anchor" aria-label="anchor" href="#install--tar-gz-archives"></a>
</h4>
<p>Using an appropriate relative path for the archive, you can install
it from source:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install the package directly from source</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"./nutrientprofiler-v1.0.0.tar.gz"</span>, repos <span class="op">=</span> <span class="cn">NULL</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span></span></code></pre></div>
<p>Change the suggested filename to suit your specific installation:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install the package directly from source</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"./nutrientprofiler-VarEdits.tar.gz"</span>, repos <span class="op">=</span> <span class="cn">NULL</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="install--zip-archives">3.2 Install <code>.zip</code> archives<a class="anchor" aria-label="anchor" href="#install--zip-archives"></a>
</h4>
<p>In order to install the package from a <code>.zip</code> file, you
need to use the <code>devtools</code> package:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install and load devtools</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_local</span><span class="op">(</span><span class="st">"./nutrientprofiler-v1.0.0.zip"</span><span class="op">)</span></span></code></pre></div>
<p>Again, change the suggested filename to suit your specific
installation.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-workflow-for-processing-data-in-bulk">Example workflow for processing data in bulk<a class="anchor" aria-label="anchor" href="#example-workflow-for-processing-data-in-bulk"></a>
</h2>
<p>Once <code>nutrientprofiler</code> has been installed on your system,
it can be imported and used interactively or run within scripts on bulk
data.</p>
<p><strong>Ensure data is formatted to match the example csv files with
same column names.</strong></p>
<p>Assuming the data that you want to analyse is stored in
<code>"data/example_data.csv"</code> and you want to save the results
to<code>"results/example_data_results.csv"</code> with all the original
columns plus the results columns, you can use a script like this:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://leeds-cdrc.github.io/nutrientprofiler/">nutrientprofiler</a></span><span class="op">)</span></span>
<span><span class="co"># read in the data</span></span>
<span><span class="va">npm_testcases</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data/example_data.csv"</span><span class="op">)</span></span>
<span><span class="co"># Analyse all entries, including specific gravity conversion, NPM scoring and assessment</span></span>
<span><span class="va">npm_testcases_results</span> <span class="op">&lt;-</span> <span class="va">npm_testcases</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> sg <span class="op">=</span> <span class="fu"><a href="../reference/SGConverter.html">SGConverter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>test <span class="op">=</span> <span class="fu"><a href="../reference/NPMScore.html">NPMScore</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, sg_adjusted_label<span class="op">=</span><span class="st">"sg"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>assess <span class="op">=</span> <span class="fu"><a href="../reference/NPMAssess.html">NPMAssess</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">assess</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">energy_score</span>, <span class="va">sugar_score</span>, <span class="va">salt_score</span>, <span class="va">fvn_score</span>,</span>
<span>  <span class="va">protein_score</span>, <span class="va">satfat_score</span>, <span class="va">fibre_score</span>, <span class="va">NPM_score</span>, <span class="va">NPM_assessment</span><span class="op">)</span></span>
<span><span class="co"># Save results to a csv file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">npm_testcases_results</span>, <span class="st">"results/example_data_results.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>This only requires slight modification if the desired input file is
instead in <code>"data/example_data.xlsx"</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load required libraries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"readxl"</span><span class="op">)</span> <span class="co"># If this is not already installed in the workspace</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://leeds-cdrc.github.io/nutrientprofiler/">nutrientprofiler</a></span><span class="op">)</span></span>
<span><span class="co"># read in the data on the first sheet of the spreadsheet (sheet = 1)</span></span>
<span><span class="va">npm_testcases</span> <span class="op">=</span> <span class="fu">read_excel</span><span class="op">(</span><span class="st">"data/example_data.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># The rest of the wokflow is the same...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<p>The most common errors to arise are likely to be related to incorrect
column names in your data, or incorrect datatypes for the values in
these columns.</p>
<p>You can check the names of the columns using
<code>names(npm_testcases)</code>.</p>
<p>You can replace column names using a script like this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://leeds-cdrc.github.io/nutrientprofiler/">nutrientprofiler</a></span><span class="op">)</span></span>
<span><span class="co"># read in the data</span></span>
<span><span class="va">npm_testcases</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data/example_data.csv"</span><span class="op">)</span></span>
<span><span class="co"># Function to rename variables</span></span>
<span><span class="va">replace_var_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data_frame</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="st">"fat_measurement_g"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_frame</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">data_frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">data_frame</span>, satfat_measurement_g <span class="op">=</span> <span class="va">fat_measurement_g</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="st">"fruit_nut_measurement_percent"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_frame</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">data_frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">data_frame</span>, fvn_measurement_percent <span class="op">=</span> <span class="va">fruit_nut_measurement_percent</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Call the function on the example data</span></span>
<span><span class="va">replaced_names</span> <span class="op">=</span> <span class="fu">replace_var_names</span><span class="op">(</span><span class="va">npm_testcases</span><span class="op">)</span></span></code></pre></div>
<p>The example shown above uses a function so that this can be reused
with multiple data sets that have the same column naming issues.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alex Coleman, Vicki Jenneson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
